#include <Wiegand.h>
#include <Servo.h>

#define BUZZER_PIN 12
#define PIR_PIN 14
#define SERVO_PIN 13

WIEGAND wg;
Servo myServo;

// Senarai ID kad yang dibenarkan
String allowedID = "12345678"; // Tukar dengan ID kad RFID sebenar

bool isDoorOpen = false;

void setup() {
  Serial.begin(115200);
  wg.begin(4, 5); // D0 dan D1 pada GPIO4 dan GPIO5
  myServo.attach(SERVO_PIN);
  pinMode(BUZZER_PIN, OUTPUT);
  pinMode(PIR_PIN, INPUT);
  
  // Servo mula dalam keadaan terkunci
  myServo.write(0);
  digitalWrite(BUZZER_PIN, LOW);
  Serial.println("Sistem Keselamatan Sedia.");
}

void loop() {
  // Bacaan RFID
  if (wg.available()) {
    String cardID = String(wg.getCode(), HEX);
    cardID.toUpperCase();
    Serial.println("Kad dibaca: " + cardID);

    if (cardID == allowedID) {
      bukaPintu();
    } else {
      Serial.println("Akses ditolak.");
    }
  }

  // Bacaan PIR untuk tutup pintu
  if (digitalRead(PIR_PIN) == HIGH && isDoorOpen) {
    tutupPintu();
  }
}

void bukaPintu() {
  Serial.println("Pintu dibuka.");
  myServo.write(90); // Servo bergerak ke kedudukan buka
  digitalWrite(BUZZER_PIN, HIGH); // Buzzer berbunyi
  isDoorOpen = true;
  delay(3000); // Tunggu 3 saat untuk membolehkan pintu tetap terbuka
}

void tutupPintu() {
  Serial.println("Pintu ditutup.");
  myServo.write(0); // Servo bergerak ke kedudukan tutup
  digitalWrite(BUZZER_PIN, LOW); // Buzzer berhenti berbunyi
  isDoorOpen = false;
  delay(1000); // Tunggu 1 saat sebelum membaca pergerakan seterusnya
}




Sambungan:
 Reka Bentuk Sistem
Input: Kad RFID akan dibaca oleh Wiegand Reader dan menghasilkan isyarat digital melalui pin D0 dan D1.
Proses: ESP8266 akan menerima dan memproses data Wiegand (26 bit) dan membandingkan dengan ID yang dibenarkan.
Output:
Servo MG90S bergerak untuk membuka atau menutup kunci.
LED hijau/merah dan buzzer memberikan isyarat kepada pengguna.
3. Sambungan Perkakasan
Wiegand Reader ke ESP8266:

D0 → GPIO4 (D2).
D1 → GPIO5 (D1).
VCC → 5V.
GND → GND.
Servo Motor ke ESP8266:

Signal → GPIO14 (D5).
VCC → 5V.
GND → GND.
LED dan Buzzer:

LED Hijau: Katod ke GND, Anod melalui resistor ke GPIO16 (D0).
LED Merah: Katod ke GND, Anod melalui resistor ke GPIO3 (RX).
Buzzer: Positif ke GPIO2 (D4), Negatif ke GND.
